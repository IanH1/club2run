<template name="header">
    <header class="main-header">
        <a href="{{pathFor 'home'}}" class="logo"><b>Club2Run</b></a>
        <nav class="navbar navbar-static-top" role="navigation">
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="sr-only">Toggle navigation</span>
            </a>
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                    {{#if currentUser}}
                        {{#if currentClub}}
                            {{> messageDropdown}}
                            {{> notificationDropdown}}
                            {{> taskDropdown}}
                        {{/if}}
                        {{#if currentUser.profile.picture}}
                            <li class="profile-picture">
                                <img class="online" src="{{profileThumbnailSrc currentUser._id}}">
                            </li>
                        {{/if}}
                    {{/if}}
                    {{> loginButtons}}
                </ul>
            </div>
        </nav>
    </header>
</template>

<template name="_loginButtonsAdditionalLoggedInDropdownActions">
    <button class="btn btn-default btn-block" id="login-buttons-edit-profile">Edit profile</button>
</template>

<template name="messageDropdown">
    <li class="dropdown messages-menu">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <i class="fa fa-comments-o"></i>
            {{#if messageCount}}
                <span class="label label-success">{{messageCount}}</span>
            {{else}}
                <span class="label label-success"></span>
            {{/if}}
        </a>
        <ul class="dropdown-menu">
            <li class="header">You have {{messageCount}} messages</li>
            <li>
                <ul class="menu">
                    {{#each messages}}
                        <li>
                            <a href="#">
                                <i class="fa fa-wechat text-aqua"></i> {{author}}
                                <br>
                                <small>{{message}}</small>
                                <div class="pull-right">
                                    <small>{{formatDateFromNow createdOn}}</small>
                                </div>
                            </a>
                        </li>
                    {{/each}}
                </ul>
            </li>
            <li class="footer">
                <a href="{{pathFor 'home'}}">See All Messages</a>
            </li>
        </ul>
    </li>
</template>

<template name="taskDropdown">
    <li class="dropdown tasks-menu">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <i class="fa fa-flag-o"></i>
            {{#if taskCount}}
                <span class="label label-danger">{{taskCount}}</span>
            {{else}}
                <span class="label label-danger"></span>
            {{/if}}
        </a>
        <ul class="dropdown-menu">
            <li class="header">You have {{taskCount}} outstanding tasks</li>
            <li>
                <ul class="menu">
                    {{#each tasks}}
                        <li>
                            <a href="#" class="task-item">
                                <i class="fa fa-flag text-aqua"></i> {{text}}
                                <div class="pull-right">
                                    <small>{{formatDateFromNow createdOn}}</small>
                                </div>
                            </a>
                        </li>
                    {{/each}}
                </ul>
            </li>
            <li class="footer">
                <a href="{{pathFor 'home'}}">View all tasks</a>
            </li>
        </ul>
    </li>
</template>