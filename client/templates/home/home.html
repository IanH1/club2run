<template name="home">
    {{#if currentClub}}
        {{#if notificationCount}}
            <div class="row">
                <div class="col-lg-12">
                    {{> notificationPanel}}
                </div>
            </div>
        {{/if}}
        <div class="row">
            <section class="col-lg-8">
                {{> calendarPanel}}
            </section>
            <section class="col-lg-4">
                {{> messagePanel}}
            </section>
        </div>
    {{/if}}
</template>

<template name="notificationPanel">
    <div class="box box-info">
        <div class="box-header with-border">
            <h3 class="box-title">Notifications ({{notificationCount}})</h3>
            <div class="box-tools pull-right">
            </div>
        </div>
        <div class="box-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th class="col-sm-7">Description</th>
                            <th class="col-sm-2">Created</th>
                            <th class="col-sm-2"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each notifications}}
                            {{#if equals type "fixture"}}
                                <tr>
                                    <td>You have been selected for {{team.name}} V {{fixture.opponent}}</td>
                                    <td>{{formatDateFromNow createdOn}}</td>
                                    <td class="text-center">
                                        <a href="#" class="hidden-xs btn btn-xs btn-primary respond">Respond</a>
                                        <a href="#" class="hidden-xs btn btn-xs btn-danger delete">Delete</a>
                                    </td>
                                </tr>
                            {{/if}}
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</template>

<template name="messagePanel">
    <div id="accordion" role="tablist" aria-multiselectable="true">
        {{#each messageBoards}}
            {{> messageBoard}}
        {{/each}}
    </div>
</template>

<template name="messageBoard">
    <div class="box box-success direct-chat direct-chat-success">
        <div class="box-header with-border">
            <h3 class="box-title">
                <a class="show-message-board" data-toggle="collapse" data-parent="#accordion" href="#{{_id}}" aria-expanded="true" aria-controls="{{_id}}">
                    {{team.name}} V {{fixture.opponent}}
                </a>
            </h3>
            <div class="box-tools pull-right">
                <span data-toggle="tooltip" title="" class="badge bg-green" data-original-title="{{messages.length}} New Messages">{{messages.length}}</span>
            </div>
        </div>
        <div id="{{_id}}" class="panel-collapse collapse" role="tabpanel">
            {{> messageBoardMessages}}
        </div>
    </div>
</template>

<template name="messageBoardMessages">
    <div class="box-body">
        <div class="direct-chat-messages">
            {{#each messages}}
                {{#if ownMessage}}
                    <div class="direct-chat-msg right">
                        <div class="direct-chat-info clearfix">
                            <span class="direct-chat-name pull-right">{{currentUser.profile.fullName}}</span>
                            <span class="direct-chat-timestamp pull-left">{{formatDateTime createdOn}}</span>
                        </div>
                        <img class="direct-chat-img" src="{{profileThumbnailSrc currentUser._id}}" />
                        <div class="direct-chat-text">
                            {{message}}
                        </div>
                    </div>
                {{else}}
                    <div class="direct-chat-msg">
                        <div class="direct-chat-info clearfix">
                            <span class="direct-chat-name pull-left">{{user.profile.fullName}}</span>
                            <span class="direct-chat-timestamp pull-right">{{formatDateTime createdOn}}</span>
                        </div>
                        <img class="direct-chat-img" src="{{profileThumbnailSrc createdBy}}" />
                        <div class="direct-chat-text">
                            {{message}}
                        </div>
                    </div>
                {{/if}}
            {{/each}}
        </div>
    </div>
    <div class="box-footer">
        <form>
            <div class="input-group">
                <input type="text" name="message" placeholder="Type Message ..." class="form-control">
                    <span class="input-group-btn">
                        <button type="submit" class="btn btn-success btn-flat">Send</button>
                    </span>
            </div>
        </form>
    </div>
</template>

<template name="calendarPanel">
    {{#if showEventModal}}
        {{#if equals showEventType "fixture"}}
            {{> eventFixtureModal}}
        {{/if}}
        {{#if equals showEventType "meeting"}}
            {{> eventMeetingModal}}
        {{/if}}
        {{#if equals showEventType "training"}}
            {{> eventTrainingModal}}
        {{/if}}
    {{/if}}
    <div class="box box-danger">
        <div class="box-header">
            <h3 class="box-title">Calendar</h3>
        </div>
        <div class="box-body no-padding">
            {{> fullcalendar header=headerOptions defaultView='agendaWeek' class="eventCalendar" events=events eventClick=eventClickHandler dayClick=dayClickHandler weekMode='liquid' minTime='08:00:00' maxTime='20:00:00'}}
        </div>
        <div class="box-footer text-black">
        </div>
    </div>
</template>

<template name="eventFixtureModal">
    <div id="eventFixtureModal" class="modal show fade in">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">{{team.name}} V {{fixture.opponent}}</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 col-xs-6">
                            <p>
                                <strong>Meetup : </strong> {{formatDateTime fixture.meetupDateTime}}<br>
                                <strong>Starts : </strong> {{formatDateTime fixture.startDateTime}}<br>
                                {{#if fixture.endDateTime}}
                                    <strong>Ends :</strong> {{formatDateTime fixture.endDateTime}}<br>
                                {{/if}}
                                {{#if fixture.address}}
                                    <strong>Location :</strong> {{fixture.address.line1}}, {{fixture.address.line2}}, {{fixture.address.city}}, {{fixture.address.county}}, {{fixture.address.postCode}}, {{fixture.address.country}}
                                {{else}}
                                    <strong>Location :</strong><br>
                                {{/if}}
                                <strong>Competition :</strong> {{fixture.competition}}<br>
                                <strong>Opponent :</strong> {{fixture.opponent}}<br>
                                <strong>Officials :</strong>{{#each fixture.officialIds}}{{official.fullName}}<br>{{/each}}
                            </p>
                            {{#if fixture.additionalInformation}}
                                <hr>
                                <p>{{fixture.additionalInformation}}</p>
                            {{/if}}
                        </div>
                        <div class="col-md-6 col-xs-6">
                            <h4>Squad Selection</h4>
                            <table class="table no-margin">
                                <tbody>
                                {{#each squadSelection.squad}}
                                    <tr>
                                        <td class="col-sm-1">{{this.squadNumber}}</td>
                                        <td class="col-sm-5">
                                            <span class="label label-{{playerStatusClass}}">
                                                {{#if availability}}
                                                    {{availability}}
                                                {{else}}
                                                    Pending
                                                {{/if}}
                                            </span>
                                        </td>
                                        <td class="col-sm-5">{{player.profile.fullName}}</td>
                                    </tr>
                                {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    {{#if currentUserInvite}}
                        <div class="btn-group">
                            <button type="button" class="btn btn-{{currentUserStatusClass}} dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                {{#if currentUserInvite.availability}}
                                    {{currentUserInvite.availability}}
                                {{else}}
                                    My Availability
                                {{/if}} <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#" class="accept">Available</a></li>
                                <li><a href="#" class="tenative">Maybe</a></li>
                                <li><a href="#" class="decline">Unavailable</a></li>
                            </ul>
                        </div>
                    {{/if}}
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</template>

<template name="eventMeetingModal">
    <div id="eventMeetingModal" class="modal show fade in">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">{{meeting.subject}}</h4>
                </div>
                <div class="modal-body">
                    <p>
                        <strong>Starts : </strong> {{formatDateTime meeting.startDateTime}}<br>
                        <strong>Ends :</strong> {{formatDateTime meeting.endDateTime}}<br>
                        {{#if meeting.address}}
                            <strong>Location :</strong> {{meeting.address.line1}}, {{meeting.address.line2}}, {{meeting.address.city}}, {{meeting.address.county}}, {{meeting.address.postCode}}, {{meeting.address.country}}
                        {{else}}
                            <strong>Location :</strong><br>
                        {{/if}}
                    </p>
                    <hr>
                    <p>{{meeting.details}}</p>
                    <hr>
                    <h4>Attendees</h4>
                    <table class="table no-margin">
                        <tbody>
                            {{#each meeting.attendeeIds}}
                                <tr>
                                    <td class="col-sm-1">
                                        <span class="label label-{{attendeeStatusClass}}">
                                            {{#if availability}}
                                                {{availability}}
                                            {{else}}
                                                Pending
                                            {{/if}}
                                        </span>
                                    </td>
                                    <td>{{attendee.profile.fullName}}</td>
                                </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    {{#if currentUserInvite}}
                        <div class="btn-group">
                            <button type="button" class="btn btn-{{currentUserStatusClass}} dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                {{#if currentUserInvite.availability}}
                                    {{currentUserInvite.availability}}
                                {{else}}
                                    My Availability
                                {{/if}} <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#" class="accept">Accept</a></li>
                                <li><a href="#" class="tenative">Maybe</a></li>
                                <li><a href="#" class="decline">Decline</a></li>
                            </ul>
                        </div>
                    {{/if}}
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</template>

<template name="eventTrainingModal">
    <div id="eventTrainingModal" class="modal show fade in">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Training : {{team.name}}</h4>
                </div>
                <div class="modal-body">
                    <p>
                        <strong>Starts :</strong> {{formatDateTime training.startDateTime}}<br>
                        <strong>Ends :</strong> {{formatDateTime training.endDateTime}}<br>
                        {{#if training.address}}
                            <strong>Location :</strong> {{training.address.line1}}, {{training.address.line2}}, {{training.address.city}}, {{training.address.county}}, {{training.address.postCode}}, {{training.address.country}}
                        {{else}}
                            <strong>Location :</strong><br>
                        {{/if}}
                        <strong>Coaches :</strong> {{#each training.coachIds}}{{coach.fullName}}<br>{{/each}}
                    </p>
                    {{#if training.additionalInformation}}
                        <hr>
                        <p>{{training.additionalInformation}}</p>
                    {{/if}}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</template>